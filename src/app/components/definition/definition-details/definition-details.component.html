<div *ngIf="!currentDefinition" class="container">
    <div class="spinner-border mx-auto my-auto">

    </div>
</div>
<div *ngIf="currentDefinition" class="container text-capitalize">
    <div class="row mb-1 py-1">
        <div class="d-flex justify-content-between">
            <div>
                <h1>{{currentDefinition.name}}</h1>
                <mat-chip-set>
                    <mat-chip>{{currentDefinition.type.name}}</mat-chip>
                </mat-chip-set>
            </div>
            <div class="d-flex gap-1">
                <button mat-raised-button color="primary" (click)="openCreateAssignmentDialog()">
                    Add Assignment
                    <mat-icon>add</mat-icon>
                </button>
                <button mat-raised-button color="accent" (click)="openDefinitionEditDialog()">
                    Edit Definition
                    <mat-icon>edit</mat-icon>
                </button>
            </div>

        </div>
    </div>
    <div class="row mb-5 py-1 border-bottom">
        <div>
            <h3>{{currentDefinition.description}}</h3>
        </div>
        <div>
            <div>
                {{currentDefinition.allowRecurring ? 'Recurring every ' + currentDefinition.frequency + ' days' : 'One Time'}}
            </div>
            <div>
                Created On:
                <span class="imp-mat-primary text-decoration-underline">
            {{formatDateString(currentDefinition.createdTime)}}
          </span>
            </div>
            <div>
                Last Modified On:
                <span class="imp-mat-primary text-decoration-underline">
          {{formatDateString(currentDefinition.lastModifiedTime)}}
        </span>
            </div>
        </div>
    </div>
    <div class="row mb-3">
        <mat-tab-group>
            <mat-tab label="Assignments">
                <ng-template matTabContent>
                    <div class="mx-0 my-3 mat-elevation-z4">
                        <mat-paginator [pageSizeOptions]="[10,15,20]"
                                       showFirstLastButtons
                                       aria-label="Select page of assignments">
                        </mat-paginator>
                        <table mat-table [dataSource]="dataSource" matSort>
                            <ng-container matColumnDef="date">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by date">
                                    Date
                                </th>
                                <td mat-cell *matCellDef="let assignment"> {{assignment.date}} </td>
                            </ng-container>
                            <ng-container matColumnDef="comment">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by comment">
                                    Comment
                                </th>
                                <td class="text-capitalize" mat-cell
                                    *matCellDef="let assignment"> {{assignment.comment}} </td>
                            </ng-container>
                            <ng-container matColumnDef="user">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header
                                    sortActionDescription="Sort by user">
                                    Assigned User
                                </th>
                                <td mat-cell *matCellDef="let assignment">
                                    <span *ngIf="assignment.username" class="imp-mat-primary">
                                       {{assignment.username}}
                                    </span>
                                    <span *ngIf="!assignment.username" class="imp-mat-warn">
                                       Not Assigned
                                    </span>
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="actions">
                                <th mat-header-cell *matHeaderCellDef>
                                    Actions
                                </th>
                                <td mat-cell *matCellDef="let assignment">
                                    <button mat-icon-button color="primary"
                                            (click)="openAssignmentDetails(assignment.id)">
                                        <mat-icon>open_in_new</mat-icon>
                                    </button>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                        </table>
                    </div>
                </ng-template>
            </mat-tab>
            <mat-tab label="Reports">
                <ng-template matTabContent>
                    Reports
                </ng-template>
            </mat-tab>
        </mat-tab-group>
    </div>

</div>
